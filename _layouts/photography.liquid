---
layout: default
---
{% if page._styles %}
  <!-- Page/Post style -->
  <style type="text/css">
    {{ page._styles }}
  </style>
{% endif %}

<style>
.photography-container {
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
  margin-top: 2rem;
  padding-bottom: 0;
  overflow: hidden;
}

.photo-grid {
  margin: 2rem 0;
  padding: 0;
}

.photo-item {
  width: calc(33.333% - 4px);
  margin-bottom: 2px;
  padding: 0;
  position: relative;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s ease;
  display: block;
  vertical-align: top;
}

.photo-item img {
  width: 100%;
  height: auto;
  display: block;
  transition: all 0.2s ease;
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: top;
}

.photo-item:hover {
  opacity: 0.8;
}


/* Photo Modal Styles */
.photo-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(20px);
  background: rgba(255, 255, 255, 0.1);
}

.photo-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.photo-modal-content {
  width: 100vw;
  height: 100vh;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  box-sizing: border-box;
}

.photo-modal-image-wrapper {
  position: relative;
  width: calc(100vw - 4rem);
  height: calc(100vh - 4rem);
  display: flex;
  align-items: center;
  justify-content: center;
}

.photo-modal-image {
  max-width: 100%;
  max-height: 100%;
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
}

.photo-modal-caption {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(transparent 20%, rgba(0, 0, 0, 0.6));
  color: white;
  padding: 1rem 1.5rem 0.75rem;
  font-size: 1rem;
  line-height: 1.3;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  
  /* Limit to 2 lines */
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

.photo-modal-image-wrapper:hover .photo-modal-caption {
  opacity: 1;
}

.photo-modal-close {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: none;
  color: white;
  border: none;
  font-size: 2rem;
  font-weight: 200;
  cursor: pointer;
  transition: opacity 0.2s ease;
  z-index: 10001;
  line-height: 1;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
}

.photo-modal-close:hover {
  opacity: 0.7;
}

.photo-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border: none;
  font-size: 3rem;
  font-weight: 200;
  cursor: pointer;
  padding: 2rem 1rem;
  transition: all 0.2s ease;
  z-index: 10002;
  line-height: 1;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
  border-radius: 4px;
  user-select: none;
}

.photo-nav:hover {
  background: rgba(0, 0, 0, 0.8);
  transform: translateY(-50%) scale(1.1);
}

.photo-nav-prev {
  left: 2rem;
}

.photo-nav-next {
  right: 2rem;
}

.photo-nav:disabled {
  opacity: 0.3;
  cursor: not-allowed;
  transform: translateY(-50%);
}

.photo-nav:disabled:hover {
  background: rgba(0, 0, 0, 0.5);
  transform: translateY(-50%);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .photo-item {
    width: 50%;
    margin-bottom: 2px;
  }
  
  .photo-modal-content {
    padding: 1.5rem;
    max-width: 98vw;
    max-height: 95vh;
  }
  
  .photo-modal-image {
    max-width: 94vw;
    max-height: 75vh;
  }
}

@media (max-width: 480px) {
  .photo-item {
    width: 100%;
    margin-bottom: 2px;
  }
}

/* Dark mode adjustments */

html[data-theme="dark"] .photo-item {
  background: var(--global-bg-color);
  border-color: var(--global-divider-color);
}

html[data-theme="dark"] .photo-item:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
}
</style>

<div class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>
    <p class="post-description">{{ page.description }}</p>
  </header>

  <article>
    {{ content }}
  </article>
</div>

<!-- Full-width photography section outside container -->
<div class="photography-container">
  <div class="photo-grid" id="photo-grid">
        {% assign photography_path = '/assets/img/photography/' %}
        {% assign image_extensions = 'jpg,jpeg,png,gif,webp,JPG,JPEG,PNG,GIF,WEBP' | split: ',' %}
        
        {% comment %} Collect and sort all photography images {% endcomment %}
        {% assign photo_files = '' | split: '' %}
        {% for static_file in site.static_files %}
          {% if static_file.path contains '/assets/img/photography/' %}
            {% assign file_extension = static_file.path | split: '.' | last %}
            {% if image_extensions contains file_extension %}
              {% assign photo_files = photo_files | push: static_file %}
            {% endif %}
          {% endif %}
        {% endfor %}
        
        {% comment %} Sort photos by filename (which includes year) {% endcomment %}
        {% assign sorted_photos = photo_files | sort: 'basename' | reverse %}
        
        {% for photo_file in sorted_photos %}
          {% assign filename = photo_file.basename %}
          {% assign full_path = photo_file.path %}
          
          {% comment %} Extract year and subject from filename {% endcomment %}
          {% assign filename_parts = filename | split: '-' %}
          {% assign year = filename_parts[0] %}
          {% assign subject_parts = filename_parts | slice: 1, 10 %}
          {% assign subject = subject_parts | join: ' ' | replace: '_', ' ' | capitalize %}
          
          <div class="photo-item" 
               data-image="{{ filename }}{{ photo_file.extname }}"
               data-title="{{ subject }}"
               data-year="{{ year }}"
               data-filename="{{ filename }}{{ photo_file.extname }}"
               data-full-path="{{ full_path | relative_url }}">
            {% comment %} Check if thumbnail exists, otherwise use full image {% endcomment %}
            {% assign thumb_path = full_path | replace: photo_file.extname, '-thumb' | append: photo_file.extname %}
            <img src="{{ thumb_path | relative_url }}" 
                 data-full-src="{{ full_path | relative_url }}"
                 alt="{{ subject }}"
                 loading="lazy"
                 onerror="this.src='{{ full_path | relative_url }}'"
                 style="width: 100%; height: auto;">
          </div>
        {% endfor %}
  </div>
</div>

<!-- Photo Modal -->
<div id="photo-modal" class="photo-modal">
  <div class="photo-modal-content">
    <div class="photo-modal-image-wrapper">
      <img id="photo-modal-image" class="photo-modal-image" src="" alt="">
      <div id="photo-modal-caption" class="photo-modal-caption"></div>
      <button class="photo-modal-close" id="photo-modal-close">×</button>
    </div>
    <button class="photo-nav photo-nav-prev" id="photo-nav-prev">‹</button>
    <button class="photo-nav photo-nav-next" id="photo-nav-next">›</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const modal = document.getElementById('photo-modal');
  const modalImage = document.getElementById('photo-modal-image');
  const modalCaption = document.getElementById('photo-modal-caption');
  const modalClose = document.getElementById('photo-modal-close');
  const navPrev = document.getElementById('photo-nav-prev');
  const navNext = document.getElementById('photo-nav-next');
  
  // Create array of all photo items for navigation
  let allPhotos = Array.from(document.querySelectorAll('.photo-item'));
  let currentPhotoIndex = -1;
  
  // Helper function to track events in Umami
  function trackEvent(eventName, eventData = {}) {
    if (typeof umami !== 'undefined') {
      umami.track(eventName, eventData);
    }
  }
  
  // Initialize Masonry layout
  const grid = document.querySelector('.photo-grid');
  let msnry;
  
  // Wait for all images to load before initializing Masonry
  const images = grid.querySelectorAll('img');
  let loadedImages = 0;
  
  function checkAllImagesLoaded() {
    loadedImages++;
    if (loadedImages === images.length) {
      // All images loaded, initialize Masonry
      msnry = new Masonry(grid, {
        itemSelector: '.photo-item',
        columnWidth: '.photo-item',
        gutter: 2,
        percentPosition: true
      });
    }
  }
  
  // Add load event listener to each image
  images.forEach(img => {
    if (img.complete) {
      checkAllImagesLoaded();
    } else {
      img.addEventListener('load', checkAllImagesLoaded);
    }
  });
  
  // Function to extract metadata and create caption
  async function formatPhotoCaption(title, year, filename, imagePath) {
    let caption = `<strong>${title}</strong><br>`;
    caption += `Captured in ${year}<br>`;
    
    // Try to extract EXIF data if available
    try {
      const img = new Image();
      img.src = imagePath;
      
      // Get image dimensions
      await new Promise((resolve) => {
        img.onload = resolve;
      });
      
      caption += `<br><strong>Technical Details:</strong><br>`;
      caption += `Resolution: ${img.naturalWidth} × ${img.naturalHeight} pixels<br>`;
      
      // Add file info
      const response = await fetch(imagePath, { method: 'HEAD' });
      if (response.ok) {
        const contentLength = response.headers.get('content-length');
        if (contentLength) {
          const sizeInMB = (parseInt(contentLength) / 1024 / 1024).toFixed(1);
          caption += `File size: ${sizeInMB} MB<br>`;
        }
      }
    } catch (error) {
      console.log('Could not extract technical details:', error);
    }
    
    caption += `<br><em>${filename}</em>`;
    return caption;
  }
  
  // Function to position overlays relative to the actual image
  function positionOverlays() {
    const imageRect = modalImage.getBoundingClientRect();
    const wrapperRect = modalImage.parentElement.getBoundingClientRect();
    
    // Calculate position relative to wrapper
    const left = imageRect.left - wrapperRect.left;
    const top = imageRect.top - wrapperRect.top;
    const width = imageRect.width;
    const height = imageRect.height;
    
    // Position caption overlay
    modalCaption.style.left = `${left}px`;
    modalCaption.style.bottom = `${wrapperRect.height - (top + height)}px`;
    modalCaption.style.width = `${width}px`;
    modalCaption.style.right = 'auto';
    
    // Position close button (centered with equal margins from top and right)
    const margin = 16; // Equal margin from edges
    modalClose.style.left = `${left + width - margin - 12}px`; // Offset by half button width
    modalClose.style.top = `${top}px`; // Let padding handle the spacing
    modalClose.style.right = 'auto';
    modalClose.style.transform = 'none';
  }

  // Function to update navigation buttons
  function updateNavButtons() {
    navPrev.disabled = currentPhotoIndex <= 0;
    navNext.disabled = currentPhotoIndex >= allPhotos.length - 1;
  }
  
  // Function to navigate to specific photo
  async function navigateToPhoto(index) {
    if (index < 0 || index >= allPhotos.length) return;
    
    const photoItem = allPhotos[index];
    const imageName = photoItem.getAttribute('data-image');
    const title = photoItem.getAttribute('data-title');
    const year = photoItem.getAttribute('data-year');
    const filename = photoItem.getAttribute('data-filename');
    const fullImagePath = photoItem.getAttribute('data-full-path');
    
    currentPhotoIndex = index;
    updateNavButtons();
    
    await openPhotoModalContent(fullImagePath, title, year, filename);
  }
  
  // Function to navigate to previous photo
  function navigatePrevious() {
    if (currentPhotoIndex > 0) {
      navigateToPhoto(currentPhotoIndex - 1);
    }
  }
  
  // Function to navigate to next photo
  function navigateNext() {
    if (currentPhotoIndex < allPhotos.length - 1) {
      navigateToPhoto(currentPhotoIndex + 1);
    }
  }
  
  // Function to open photo modal content (extracted from openPhotoModal)
  async function openPhotoModalContent(imagePath, title, year, filename) {
    modalImage.src = imagePath;
    modalImage.alt = title;
    
    // Show loading state
    modalCaption.innerHTML = 'Loading image details...';
    
    // Update URL hash for direct linking
    const imageParam = filename.replace(/\.[^/.]+$/, ''); // Remove extension
    window.history.pushState({}, '', window.location.pathname + window.location.search + '#photo:' + imageParam);
    
    // Track photo view event
    const photoId = filename.replace(/\.[^/.]+$/, '').substring(0, 30); // Remove extension and limit length
    trackEvent(`photo-${photoId}`, {
      image: filename,
      title: title,
      year: year
    });
    
    // Wait for image to load and then position overlays
    modalImage.onload = function() {
      setTimeout(positionOverlays, 10); // Small delay to ensure layout is complete
    };
    
    // If image is already cached and loaded
    if (modalImage.complete) {
      setTimeout(positionOverlays, 10);
    }
    
    // Load caption with metadata
    try {
      const caption = await formatPhotoCaption(title, year, filename, imagePath);
      modalCaption.innerHTML = caption;
    } catch (error) {
      // Fallback to basic caption
      modalCaption.innerHTML = `<strong>${title}</strong><br>Captured in ${year}<br><br><em>${filename}</em>`;
    }
  }

  // Function to open photo modal
  async function openPhotoModal(imagePath, title, year, filename) {
    modal.dataset.scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
    
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // Find current photo index
    currentPhotoIndex = allPhotos.findIndex(item => item.getAttribute('data-filename') === filename);
    updateNavButtons();
    
    await openPhotoModalContent(imagePath, title, year, filename);
  }
  
  // Add click event to all photo items
  document.querySelectorAll('.photo-item').forEach(item => {
    item.addEventListener('click', async function() {
      const imageName = this.getAttribute('data-image');
      const title = this.getAttribute('data-title');
      const year = this.getAttribute('data-year');
      const filename = this.getAttribute('data-filename');
      const fullImagePath = this.getAttribute('data-full-path');
      
      await openPhotoModal(fullImagePath, title, year, filename);
    });
  });
  
  // Close modal functions
  function closeModal() {
    const scrollPosition = parseInt(modal.dataset.scrollPosition) || 0;
    
    modal.classList.remove('active');
    document.body.style.overflow = '';
    
    // Remove photo hash from URL
    window.history.replaceState({}, '', window.location.pathname + window.location.search);
    
    setTimeout(() => {
      window.scrollTo(0, scrollPosition);
    }, 50);
    
    // Track modal close event
    trackEvent('photo-close');
  }
  
  modalClose.addEventListener('click', closeModal);
  navPrev.addEventListener('click', navigatePrevious);
  navNext.addEventListener('click', navigateNext);
  
  // Close when clicking outside the image (on blurred background)
  modal.addEventListener('click', function(e) {
    // Close if clicking on the modal background or modal content (but not the image or its overlays)
    if (e.target === modal || e.target === modal.querySelector('.photo-modal-content') || e.target === modal.querySelector('.photo-modal-image-wrapper')) {
      closeModal();
    }
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    if (modal.classList.contains('active')) {
      switch(e.key) {
        case 'Escape':
          closeModal();
          break;
        case 'ArrowLeft':
        case 'ArrowUp':
          e.preventDefault();
          navigatePrevious();
          break;
        case 'ArrowRight':
        case 'ArrowDown':
          e.preventDefault();
          navigateNext();
          break;
      }
    }
  });
  
  // Handle direct photo links via URL hash
  function handlePhotoHash() {
    const hash = window.location.hash.substring(1);
    if (hash.startsWith('photo:')) {
      const photoId = hash.substring(6); // Remove 'photo:' prefix
      const photoItem = document.querySelector(`[data-image*="${photoId}"]`);
      if (photoItem) {
        photoItem.click();
      }
    }
  }
  
  // Handle hash changes (back/forward buttons)
  window.addEventListener('hashchange', function() {
    const hash = window.location.hash.substring(1);
    if (hash.startsWith('photo:')) {
      handlePhotoHash();
    } else if (hash === '' && modal.classList.contains('active')) {
      closeModal();
    }
  });
  
  // Check for photo hash on page load
  handlePhotoHash();
  
  // Reposition overlays on window resize
  window.addEventListener('resize', function() {
    if (modal.classList.contains('active')) {
      setTimeout(positionOverlays, 10);
    }
  });
  
  // Set up impression tracking for photos
  const observedPhotos = new Set();
  const photoObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
        const photoItem = entry.target;
        const photoId = photoItem.getAttribute('data-filename').replace(/\.[^/.]+$/, '');
        const photoTitle = photoItem.getAttribute('data-title');
        const photoYear = photoItem.getAttribute('data-year');
        
        // Only track each photo impression once per session
        if (!observedPhotos.has(photoId)) {
          observedPhotos.add(photoId);
          
          const photoSlug = photoId.substring(0, 30);
          trackEvent(`photo-view-${photoSlug}`, {
            photoId: photoId,
            title: photoTitle ? photoTitle.substring(0, 50) : 'Unknown',
            year: photoYear
          });
        }
      }
    });
  }, {
    threshold: 0.5, // Trigger when 50% of the photo is visible
    rootMargin: '0px'
  });
  
  // Observe all photo items
  document.querySelectorAll('.photo-item').forEach(photoItem => {
    photoObserver.observe(photoItem);
  });
  
  // Track photography page load
  trackEvent('photo-page-load', {
    totalPhotos: document.querySelectorAll('.photo-item').length
  });
});
</script>